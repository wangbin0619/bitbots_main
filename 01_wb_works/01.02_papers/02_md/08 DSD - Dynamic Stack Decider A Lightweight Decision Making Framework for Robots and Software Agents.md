Content courtesy of Springer Nature, terms of use apply. Rights reserved.

InternationalJournalofSocialRobotics(2022)14:73–83https://doi.org/10.1007/s12369-021-00768-8DSD-DynamicStackDeciderALightweightDecisionMakingFrameworkforRobotsandSoftwareAgentsMartinPoppinga1·MarcBestmann1Accepted:18February2021/Publishedonline:18March2021©TheAuthor(s)2021AbstractWepresenttheDynamicStackDecider(DSD),alightweightopen-sourcecontrolarchitecture.Itcombinesdifferentwell-knownapproachesandisinspiredbybehaviortreesaswellashierarchicalstatemachines.TheDSDallowstodesignandstructurecomplexbehaviorofrobotsaswellassoftwareagentswhileprovidingeasymaintainability.Challengesthatoftenoccurinrobotics,i.e.,adynamicenvironmentandsituationuncertainty,remainwell-manageable.Furthermore,itallowsfastmodiﬁcationsofthecontrolﬂow,whileprovidingthestate-fullnessofastatemachine.TheapproachallowsdevelopingsoftwareusingasimpleDomainSpeciﬁcLanguage(DSL)whichdeﬁnesthecontrolﬂowandtwotypesofelementsthatcontaintheprogrammedparts.Theframeworktakescareofexecutingthedemandedportionsofthecodeandgives,duetoitsstack-likeinternalrepresentation,theabilitytoverifypreconditionswhilemaintainingaclearstructure.Thepresentedsoftwarewasusedindifferentroboticscenariosandshowedgreatperformanceintermsofﬂexibilityandstructuredness.KeywordsControlarchitecture·Framework·Behavior·Robots·Agents1IntroductionAvarietyofchallengesneedstobetackledinroboticstocre-atesoftwarethatcanproduceacomplexbehavior.Acontrolarchitecturehelpstofulﬁllthesetasks.Whilesomeco-routinesliketheimageprocessingorthewalkengineperformscenario-speciﬁc,well-deﬁnedtasks,high-levelplanninghastosolvemoreabstracttasksincomplexenvironments.Thislogicallayer,whichdecideswhatactionneedstobeper-formed,iscalledthebehaviorinthefollowing.Inearlieryears,complexbehavioronahighlevelwasoftenlimited,asmostsystemsweredesignatedforaspeciﬁctask,e.g.,cleaningtheﬂoorofaroom.Duetoadvancementsinrobotics,decision-makingprocessesarebecomingmorecomplex,especiallybecauseinreal-worldroboticscenariosmostoftennoclosedworldassumptioncanbemade.Forexample,incompetitiveenvironmentswithmultipleagentsBMartinPoppingapoppinga@informatik.uni-hamburg.deMarcBestmannbestmann@informatik.uni-hamburg.de1DepartmentofInformatics,UniversitätHamburg,Vogt-Kölln-Straße30,22527Hamburg,Germanyor,inthecaseofhuman-robotinteraction,differentrolesandstrategiesneedtobespeciﬁed,andswitchedon-demand,astheenvironmentchangesquicklyandthebehaviorneedstobeadaptedtonewsituations.Similaristrueforsoftwareagentswhodealinuncertainenvironments,forexample,whenhumansorotheragentsareinvolved.Thepresentedapproachconsistsoftwoparts.First,theprogrammedmodulesofthebehavior,whichdecideandtheact,andsecond,asimpleDomainSpeciﬁcLanguage(DSL)whichconnectsthesemodulesanddeﬁnesthecontrolﬂow.ThisDSLallowsfastadaptionsintherobotbehaviorwithoutalteringthesourcecodeofthemodules.ThisframeworkwasinitiallydesignedforchallengesintheRoboCupcompetition[11]andwasdevelopedintheHumanoidSoccerLeagueandusedforexampleonthehumanoidrobotplatformWolfgang[3](seeFig.1).How-ever,itwasadaptedforotherareasofroboticsandshoweditsbeneﬁtsoutsideoftheRoboCupcompetition,too.TheDSDproveditsadvantagesinseveralcompetitionssince2015andwasimprovedseveraltimes,includingaclearerformalisminearly2017underthenameActiveSelfDecidingStackandtheadditionoftheDomainSpeciﬁcLanguageinlate2018.We123Content courtesy of Springer Nature, terms of use apply. Rights reserved.

74InternationalJournalofSocialRobotics(2022)14:73–83Fig.1ThehumanoidrobotplatformWolfgang(a)andagameintheRoboCupcompetition(b)inwhichtheDSDhasprovenitselfuseitashigh-leveltacticsbehavior1aswellasanabstrac-tionlow-levelabstractionmechanism[4]2.Itcanbeusedforcompacthigh-levelcontrolofrobotbehaviorandotherstate-machine-likesituations.Furthermore,itwassuccess-fullyappliedinthescenarioofamobileroboticbartenderandwontheﬁrstplaceintheIROS2018MobileManipula-tionHackathon3,4.IntheRoboCupHumanoidSoccercompetition,onlyhuman-likesensorsareallowed,andthusobjectrecognitioninlargerdistancesprovidesadifﬁculttask,anddecisionsaremadeinanuncertainenvironment.Thischallengeincreases,astheenvironmentholdsmultiplerobotsofwhichhalf,theopposingteam,donotprovideinformation.Similarchal-1https://github.com/bit-bots/bitbots_behavior.2https://github.com/bit-bots/bitbots_motion.3http://iros18-mmh.pal-robotics.com/.4https://github.com/TAMS-Group/tiago_bartender/tree/master/tiago_bartender_stackmachine.lengesoccurinotherexamplesassensorinformationisoftenimperfectandexternalchangesrequirequickchangesintheprogrammingroutine.Asidefromhigher-leveldecisionmaking,otherpartsintherobotsoftwarerequirestate-fulldecisionmakingandeasilymaintainableframeworksforanefﬁcientdevelopmentprocess,too.Toenableafeature-richimplementationtohandlethiscomplexityindecisionmakingaswellasforthedeveloperstoadaptandmaintainthesourcecode,weextractedseveralaspectsfortheherepresentedframeworkthatneedtobeconsidered:–States:Fordebugginganddevelopmentitisnecessarythatdeveloperscaneasilyevaluateinwhichstatetheagentcurrentlyis.Furthermore,somesub-tasksmayhaveatimecomponentwhichrequiresthemtostaywiththeirformerdecisionduringexecution.–Reevaluationofpreviousdecisions:Inadynamicenvi-ronmentpreconditionscanchangerapidly.Itisrequiredtoreevaluateallsuchconditionsandchangethebehav-ioraccordinglypromptlywithoutgettingstuckinanunwantedstate.–Divisibility:Forstructuredtestingandfastdebuggingtheabilitytolaunchallsub-partsofthebehaviorseparatelyisbeneﬁcial.–Maintainability:Changingoraddingpartstothebehav-iorhastobepossibleatalltimeswithouttheneedforageneralrestructuring.–CodeReuse:Asmanyroutinescanoccurincompletelydifferentstates,amechanismtopreventcodeduplica-tionispreferable.Themeanstoavoidrewritingspeciﬁcbehaviorstepsaswellasrequiringtoperformthesamecheckinvariousmodules.–Scalability:Thelogicneedstoexpresscomplexbehaviorforautonomoussystemswhilestayingclearandunder-standable.Thispaperisstructuredasfollowed.InSection2therelatedworkandexistingapproachesandframeworksforhigh-levelbehaviorarepresented.OurapproachispresentedinSection3andsomeinsightintotheimplementationisgiveninSection4.InSection5weevaluatetheproposedapproachandgiveamorecomplexexampleinSection6.Finally,inSection7weconclude.WhiletheframeworkwasoriginallydesignedfortheuseinroboticsusingtheROSMiddleware5,thepresentedapproachandthepublishedsoftwarearealsosuitableforotheruse-casesoutsideofrobotics.Inthefollowing,thetermagentreferstorobotsaswellassoftwareagents.5https://ros.org123Content courtesy of Springer Nature, terms of use apply. Rights reserved.

InternationalJournalofSocialRobotics(2022)14:73–8375Fig.2Simpliﬁedexampleofthedirectacyclicgraph(DAG)whichisdeﬁnedbytheDSLusingtheoutputoftheDEs.Achosenpath(blue)isdisplayed.Theagentdecidedonbeinganattackerandgoingtotheball.Thesetakendecisionsandthecurrentactioncanbeseeninthestack(cp.Fig.3).SincetherearemultiplewaystoreachtheGoToBallDirectaction,itisnecessarytohaveahistoryonthestacktoretracetheagent’sdecisionsRole DecisionDefendAttackDecisionYesBallPositionAvailableClosestPlayerToBallInKickDistanceGoToBallDirectField PlayerAttackYesYesNoStartGoalieDefendNoNoKickBallYesWait[...]NoBallInOwnHalf[...][...]2RelatedWorkDuetotheimportanceofcontrolarchitecturesinmanyﬁelds,severalapproachesweredeveloped.Someofthem,e.g.,ﬁnitestatemachines(FSM)[9],existforalongtime.Others,likebehaviortrees[6],aremorerecentandmostlyusedinthedomainofvideogames.Thesehavealreadyproventobesuitableforcomplexbehaviors,buttheyarenotalwaysideallysuitedfortheuncertainenviron-mentsofroboticsorinfortheuseincompetitions,wherethesoftwareneedstoadaptconstantly.Robotbehaviour,whileinmanyscenariosisusedfornavigationpurposes[1],vari-oustaskscanbesolvedusingthesedifferentapproaches[2].Inthefollowingsection,theadvantagesanddisadvantagesofthemostpopularapproachesarediscussed.Theyarecom-paredwithourapproachinFig.2.2.1StateMachinesFSMTheﬁnitestatemachine(FSM)[9]isacommonlyusedapproachbasedonaﬁnitesetofdiscretestatesoftheagent.Transitionsaredeﬁnedbetweenthestates.Typically,actionsareperformedwhileenteringandleavingastateaswellaswhilethestateisactive.Whilethisapproachisinherentlystatefulandstraightforwardtounderstand,itsscalabilityandmaintainabilityarebadduetothehighnumberoftransitions.Furthermore,testingiscomplicatedduetobaddivisibility.HFSMHierarchicalﬁnitestatemachines(HSMs)[10]areanextensionoftheFSM.Here,thestatesareorganizedinahierarchicalstructure.Statescanbesubstatesofotherstateswhichenablestheinheritanceofbehaviorfromsuperstates.Thisway,eachsubstateonlyneedstofocusonitsdesignatedtasksandeventswhileitsancestorscanhandlemoregeneralevents.Thispreventsstateexplosionandcodeduplicationincomplexsystems.Still,HFSMsarehardtomaintainsinceaddingorremov-ingstatesrequirestheprogrammertoreevaluatealargenumberoftransitions[6].2.2PlanningForplanningsequencesofactionsandexecutingthem,multi-pleapproachesexistthatfollowatraditionalSense-Plan-Actmanner.ThemostprominentexampleisSTRIPS[8].Inrecentyearsthisareawasalsoinﬂuencedbythegam-ingindustryandnewapproachesarose,e.g.,Goal-OrientedActionPlanning[12].Whiletheseapproachescanbeusedtocreatesophisticatedbehaviors,theirreactivenessislow,andtheyoftenrelyontheclosedworldassumption,makingthemnotapplicableinmanyreal-worldscenarios.123Content courtesy of Springer Nature, terms of use apply. Rights reserved.

76InternationalJournalofSocialRobotics(2022)14:73–832.3SubsumptionTheSubsumptionArchitecture(SA)[5]wasintroducedasasolutiontothelowreactivenessofclassicalplanningapproaches.Itdividesthetaskintosubtasksthatcanruninparallelbuthaveahierarchicalorder.Moreimportantpartscansubsumeothersinthecontroloftherobot’sactuators.Whilethisapproachhasahighreactiveness,itisnotstate-fulandthereforeverylimited,especiallyinﬁndingoptimalsolutionsormakingdecisionsbasedonpreviousactions.2.4DecisionTreesDecisiontrees(DTs)[13]areasimpleconceptofconnect-ingmultipleconditionsintoatree-likestructure.Theyare,amongothers,appliedintheareaofartiﬁcialintelligenceforsolvingclassiﬁcationproblems,butalsofordecisionmaking.Whilesimpletoimplementandintuitivelyunderstandable,theyarestateless.Duringeachiteration,alldecisionshavetobereevaluatedwhichisexpensive.Sincetheresultisonlybasedonasingleiteration,itcanleadtojumpingbackandforthbetweentwodifferentresults,especiallywhenusingnoisysensordata.Thismakesitchallengingtoimplementnon-instantaneousactions.Forexample,acollisionavoid-ancedecisiontreemightoutputsalternatingsteerleftandsteerrightwhenpresentedwithanobstaclerightinfront.Thenoiseofthesensorwillsometimesputitmoretotheleftandsometimesmoretotheright,mayberesultinginacrash.2.5BehaviorTreesBehaviortrees(BTs)[7]createahierarchicaltreestructureofcontrolelementsthatresultinactionsorconditionsasleafs.Itispossibletodeﬁnecompositetaskswhichareperformedsequentiallyorinparallel.Duetothepossibleparallelismandloopedconditions,thereisnotonlyonepointofactivityinthetree,butdistantpartscanbeactiveatthesametime.Thismakesitdifﬁculttoseethecurrentstateofatreeataglance.Furthermore,thedecisionpaththroughthetreeislessclearthanitisinadecisiontreebecausetheconditionsareleafnodesandnotinternalnodes.Thismakesadiffer-entiationbetweenactionsandconditionsmoredifﬁcult.TheimplementationofaBTengineiscomplexsinceparallelismhastobeconsidered[6].SinceBTsaretickdriven,ratherthanevent-drivenlikemostapproaches,itrequiresachangeofparadigm[6].Inlargerclosed-loopsystems,manycon-ditionsmayhavetobechecked,leadingtoahighexecutiontime[6].3TheDynamicStackDeciderOurapproachcombinesthesimplicityandstatefulnessofanFSMwiththeﬂexibilityandscalabilityofabehaviortreetoachievealight-weightedcontrolarchitecturethatcanhan-dlethedynamicanduncertainenvironmentinrobotics.TheDynamicStackDecider(DSD)consistsinitscentralpartofastack-likestructurethatordersthecurrentlyloadedpartsofthebehavior.Similartomanycontrolsystems,theDSDisexpectedtobecalledperiodicallytoevaluateitscurrentstateandtotakeactions.ADomainSpeciﬁcLanguage(DSL)isspeciﬁedthatdeﬁneswhichelementsarepushedontopofthestackdependingontheoutputofthecurrentlyexecutedelementandthecurrentpositioninthetree-likestructure.TheDSLdeﬁnesallpossibleexecutionpathsandcreatesadirectedacyclicgraph(DAG).UsingthisDSL,furtherparameterscanbepassedtotheelements.Theelementsonthestackaredividedintodecisionandactionelements.Thestackholdstheactivecomponentsinthecurrentstateaswellasthehistorywhichleadtothecurrentstate.Thisconceptisexplainedinmoredetailinthefollowing.3.1TheElementsDecisionElementsEachdecisionelement(DE)capsulesonelogicaldecisionandhasaﬁnitesetofpossibleoutputs.Itdoesnotcontrolitsactorsorisinanykindalteringtheenvironment.Decisionscanbeascomplexasneeded,usingif-elseclausesforsimplecasesor,inamorecomplexsituation,forexample,neuralnetworks.OneexampleintheRoboCupSoccerdomainisthedecisionwhethertheagenthassufﬁcientknowledgeaboutthecurrentballpositioninitsworldmodel.Thisdecisionelementcouldbefollowedbyanactiontosearchfortheballoradecisionwhethertheagentshouldwalktowardstheball.DEsareusedintwoways.Iftheyareontopofthestack,thefollowingelementisputontop(pushed)andthiselementisexecutednext.IfaDEisinsidethestack,itcanspecifyifitwantstobereevaluated.WhenaDEisreevaluated,theoutcomeoftheproductioniscomparedtotheoutcomeofthesameelementinthepreviousiteration.Ifitisidentical,thestackremainsunaltered.Whentheoutcomediffers,thestackabovethereevaluatedDEisdiscarded,andthenewsub-treeisputontop.Thismethodiscrucialforvalidatingprecondi-tions,e.g.,havingsufﬁcientknowledgeoftheballlocationisnecessarytobeabletogotowardsit.Thismechanismisfurtherexplainedin3.3.ActionElementsThesecondtypeofelementistheactionelement(AE).AnAEissimilartoastateofanFSM,inthemeaningthatthesystemstaysinthisstateandexecutesitslogicaslongasthe123Content courtesy of Springer Nature, terms of use apply. Rights reserved.

InternationalJournalofSocialRobotics(2022)14:73–8377AEisontopofthestack.ThisisincontrasttoaDEwhichisevaluatedinstantaneously.AnexemplaryAEisakickorastand-upanimationthatstaysontopofthestackuntiltheanimationhasﬁnishedplaying.AnAEcouldalsohandlegoingtotheball.Inthiscase,theAEremainsontopofthestackuntiltheballisreached.TheAEonlymakesdecisionsthatarenecessaryforitsownpurpose,e.g.,someadjustmentstothekickingmovement.AEsdonotpushfurtherelementsonthestackbutcontrolactionsonlower-levelmoduleslikejointgoals.IftheAEhasﬁnished,itcanremoveitselffromthestackbyperformingapopcommandorotherwiseremainsactiveuntilapreconditionbecomesinvalid.3.2DSDDescriptionLanguageForeasymaintainabilityandvisualization,thepossibleexecutionﬂowsaredescribedinadesignateddescriptionlan-guageanoverviewofthesymbolsisshowninTable1.ThisrepresentationisparsedwhileinitializationoftheDSD.TheDSLdetermineswhichreturnvalueofadecisionelementleadstowhichelementexecutedinthefollowing.InListing1anexamplebehaviorisgiven,creatingtheDAGasshowninFig.2.1#Kick2$InKickDistance+kick_threshhold:0.13"Yes"−−>@KickBall4"No"−−>@GoToBallDirect56#Attack7$ClosestPlayerToBall8"Yes"−>#Kick9"No"−>@Wait1011−−>SampleBehavior12$RoleDecision13"FieldPlayer"−−>$BallPositionAvailable14"No"−−>[...]15"Yes"−−>$DefendAttackDecision16"Defend"−−>$BallInOwnHalf17"No"−−>@Wait18"Yes"−−>#Attack19"Goalie"−−>[...]20[...]−−>#KickListing1ExampleoftheusedDSL.WithKickandAttack,twosubtreesaredeﬁned.SampleBehaviordeﬁnesthestartingpoint.Dependingontheoutputofthe$RoleDecisiondifferentpathsareexecutedinthecontrolﬂowwhichleadstothecorrespondingactions.Thisstructureallowsfastchangesofconnectionsaswellasparameters(e.g.,thresholds,speeds)inoneplace,givingagoodoverviewwithouttherequirementofsearchinginlonglistsofparametersordirectlyinthecode.Duetothesemanticnamingofdecisionresults,transitionchangescanbeperformedlocally.Table1ThesesymbolsareusedintheDSL.TheyassembletheDAGasshowninFig.2Fig.3ExampleofastackforaﬁeldplayeraftertakingthedecisionsasdisplayedinFig.2.EachtimestepallDEswhichshouldbere-evaluatedarecalledfrombottomtotop.Ifnopreconditionchanged,theAEontopofthestackisexecuted3.3CallStackThebuiltstackfollowsasimilarlogicascallstacksinvar-iousprogrammingenvironments(e.g.,Python,Java,.NET),providingthecurrentcallstackasapathtotheﬁnallyexe-cutedmodule.However,inthisarchitecture,eachelementonthestackcanremainactive.ThecontrolworkﬂowoftheDSDissketchedinFig.4anddescribedinthefollowing:TheDSDisinitializedwithonedecisiononthestack(Fig.3)astherootdecision.ThiscanbeanynodeintheDAG,allowingsimpleexecutionofsubgraphs/sub-behaviors.Eachiteration,allDEsonthestackcanbereevaluatedfrombottomtotoptoseeifanypreconditionshavechanged.Forthis,eachDEischeckedifitrequirestobereevaluated.Ifithastobereevaluated,theDEisre-performed,andtheoutcomeiscomparedtotheoutputofthepreviousiteration.Ifithaschanged,thestackabovethecurrentDEiscleared,andthenewoutcomeispushed.Otherwise,thenextelementischeckedtobereevaluated.Aftereveryelementhasbeenreevaluated,oraftertheﬁrstdifferentoutcome,thereevaluationphaseisﬁnished.Then,thetopmostelementisexecuted.Ifthetopmostelementis123Content courtesy of Springer Nature, terms of use apply. Rights reserved.

78InternationalJournalofSocialRobotics(2022)14:73–83Fig.4ThecontrolﬂowoftheDSDDSDInitialize Stack withRoot ElementReevaluation phasereevaluation requestedelementsall emvaluatedevvuCheck each Element onStack (Bottom to Top)sameresultother resultExecute Elementinitial startinterruptpush new elementDrop all ElementsAbovepush or popwhile executionPerform TopmostElementcall for eachiterationno push or popend of iterationnoreevaluationaDE,itisexecuted,anditsoutcomedeﬁnes,accordingtotheDSL,whichelementorelementsisorarepushednextonthestack.Ifanelementpushesoneormultipleelementsonthestack,thetopmostitisdirectlyexecuted,enablingtheevaluationofmultipleDEsinonecycle.IfthetopmostisanAE,theAEisexecuted.IftheAEpopsitselffromthestack,thenewtopmostelementisexecuted.IfthetopmostelementisanAEandperformsnopop,itstaysontopofthestack,andtheDSDhasﬁnisheditsiteration.ThiswaytheAEisexecutedeachiterationuntileitherapreconditionchanges(ascheckedinreevaluation)ortheAEpopsitselfaftercompletion.Atanytimeanexternalinterruptcanclearthestackandstartagainwiththerootelement.Byusingthisstack-likestructure,itisalwaystraceablewhichactiontheagenttriestoperformandwhichdecisionsweremade.3.4ExtendedFeaturesAfewadditionalfeaturesareaddedtothebasestructuretofacilitatetheuseoftheDSD:InterruptsAninterruptisaneventfromoutsideofthestructure,whichclearsthecompletestacktoresetthebehaviorasdis-playedinFig.4.IntheparticularcaseofRoboCup,weuseitwhenthegamestatechanges,forexample,ifagoalwasscored.However,itcanalsobeused,forexample,iftheagentiskidnappedorpaused.Aftertheinterrupt,thestackisrecreated,startingattherootelement.ReevaluateEachdecisionelementmaydeﬁneareevaluatecriteria.Ifthecorrespondingmethodreturnstrue,theelementwillbeexecutedduringthereevaluationphaseevenifitisinthemiddleofthestack.Thiswayapreconditioncanbecheckedconstantlyorperiodically.Asanexample,everyiterationitcouldbecheckediftheballpositionisknowntotheagentwithagivencertainty.Ifthenowpushedelementisdiffer-entfromtheelementwhichiscurrentlyaboveinthestack,meaningthatthedecisionchanged,thewholestackabovewillbedroppedandthenewlyselectedelementexecuted.Additionally,actionscanspecifysetado_not_reevaluateﬂagwhichpreventsalldecisionelementsfrombeingreevaluated.Semantically,thisallowstospecifyactionsthatcannotbeinterrupted,e.g.stoppingadynamicmotionanimationonabipedalrobotwouldleadtoafall.PassingargumentsItispossibletopassargumentstodecisionandactionelementsdirectlyintheDSL.Thisimprovesthegeneraliza-tionofstackelementsandallowstousethesameelementsinmultiplepartsoftheDAG.Forexample,itispossibletoimplementaMoveActionthattakesanargumentonthedirectiontomoveratherthanimplementingMoveForwardandMoveBackwards.AnexampleofhowthisisspeciﬁedintheDSLisshowninListing1.123Content courtesy of Springer Nature, terms of use apply. Rights reserved.

InternationalJournalofSocialRobotics(2022)14:73–8379ActionsSequencesItispossibletoperformasequenceofactions.Forthis,aDEcanpushmultipleAEsatonceontopofthestack.Inthiscase,atﬁrst,onlythetopmostAEisexecuted.Iftheelementispoppedfromthestack,thenextactionisdirectlyexecuted.Thiswayforexamplemovementpatternscanbeexecutedovermultipleiterationsunlessanyprecon-ditionschange.Alternatively,anAEcanbepushed,whichdoesonlyonetaskforasingleiteration,e.g.sendingames-sagetootheragentsandthenpoppingitself,followedbyamovementinthesecondAE.4ImplementationThereferenceimplementationiswritteninPython.UsingPython[14]allowsfastdevelopmentduetoitswellreadablesyntaxandtheabsenceoftheneedtorecompilethecodeonchanges.Further,featurerichlibraries,likescipyorten-sorﬂowcanbeusedifneeded.Asdecisionmakinginthepresentedcontextisnotcrucialtomilliseconds,thereducedperformanceincontrasttoanoptimizedC++variantisnegli-gible.However,thesamepatternsofaDSDwouldalsoapplytoruntime-sensitivelanguages,asi.e.C++.Listing2showsanexampleofasimpledecisionelement.Eachelementinheritsfromanabstractclass.1fromDSDimportDecisionElement23classInKickDistance(DecisionElement):4defperform(self,data,param):5ifdata.world_model.get_ball_dist()<(cid:2)→param["kick_threshhold"]:6return"Yes"7else:8return"No"910defget_reevaluate(self):11returnTrueListing2Anexampleofasimpledecisionelement.Itcheckseveryiterationwhethertheballiscurrentlyclosetotheagent.DataExchangeEachstackelementholdsitsinstancevariablesaslongitisinthestack.Thedataisdiscardedwhentheelementisremovedfromthestack.Ifpersistentdataisrequired,itcanbewrittentoasharedblackboard.Datarequiredbytheelementsisstructuredindifferentscopes,whichencapsulatedifferentpartsoftheagent’sknowledge.Forexample,infor-mationcomingfromthevisionishandledseparatelyfromtheinformationoftheinter-agentcommunication.Thisdatacanbestoredlocallyorpublishedtootherprocesses.Forthispurpose,adatahandlerintheformofapythonobjectcanbepassedtotheframeworkatstartup.Thegettermaydeﬁnedefaultvaluesifnodataisexist-ing.Settersareonlyexistingwhereitisnecessarytopublishinformation.Inmostcases,thedecisionsusethegetterstoobtaininformationfromotherpartsofthesystem,andonlytheactionspublishcommandsanddatausingthesettersforexternalmodules.RunningMultipleInstancesIftwoormoreindependentbehaviorsarerequired,itispossibletocreatemultipleindependentbehaviorstacks.Forexample,inrobotsoccer,thebehavioroftheheadisoftencontrolledsemi-independentlyfromthebodybehav-ior.There,thehead,equippedwithacamera,collectsdatawhilethebodymayrequesttoobtaincertaininformation.Astheseareindependentprocesses,nocommonblackboardisaccessibleforcommunicationbetweenthedifferentDSDinstances.Inthiscase,forexample,communicationishan-dledbyROSmessages.ReusingModulesInsomecases,itisrequiredtousethestackelementssev-eraltimesbutwithmodiﬁeddecisionsorotheroutcomes.Inthesecases,amodulecanbereusedandgivenadifferentpathinthedescriptionﬁleandotherparameterscanbepassed.VisualizationWhenintegratedintoROSitispossibletocreateareal-timeviewoftheactiveactionandelementsonthestack,cp.Fig.5.AswellasalternativepathsintheDAG.FutureWorkonImplementationWeplantofurtherimprovetheusabilityofourimplemen-tationbyprovidingaGUItocreateDSDs,whicharethensavedintheDSL.Thisimprovestheoverviewandlowerstheentrybarrier.Furthermore,wewanttointroduceauto-maticsanitychecks,thatverify,forexample,ifallelementsarepartofthesamegraphandifalloutcomesofaDEleadtoanotherelement.5EvaluationInthefollowing,weevaluatedifferentaspectsoftheDSDcomparedtootherframeworks,especiallytobehaviortrees.AnoverviewcanbeseeninTable2.HierarchicalorganizationTheDSDallowsclearhierarchicalorderingofimportancebasedonthedecisionelement’spositiononthestack.Duringthereevaluationphase,DEswhichareclosertothebottomofthestackareperformedearlierandarethereforemoreimportant.ThisisalsovisibleintheDSLdescriptionoftheDSDsinceelementsspeciﬁedearlierwillenduploweronthestack.Theorderingofimportanceistherebyclearlyvisibleandchangeablebeforeandduringruntime.123Content courtesy of Springer Nature, terms of use apply. Rights reserved.

80InternationalJournalofSocialRobotics(2022)14:73–83Fig.5LivevisualizationofanexemplarystackDAGinsiderqtTable2Comparisonofdifferentcontrolarchitectures.Partlyfollowing[6,Chapter2]FSMHSMSADTBTDSDHierarchicalorg.-++++++Codereuse-◦◦++++Maintainability–◦--++Humanreadable-◦-+◦++Stateful++--++Scalability–◦-◦+++Conceptcompre.++◦++--Theotherframeworksperformmostlysimilarinthisregard,withtheexceptionoftheFSM,whichdoesnotallowsuchanordering.CodereuseReusingexistingcodeparts,insideonebehaviorandfrompreviousones,cansigniﬁcantlydecreasedevelopmenttime.TheDSDperformsespeciallywellinthisregard,duetotheclearseparationofdecisionandactionelements.Further-more,theusedDSLallowssimpleandfastcreationofabehaviorwhenreusingexistingdecisionandactionelements.Inbehaviortrees,thereisonlyseparationbetweenactionsandconditions.Thedecisionsareencodedbyacombinationofconditionsandcontrolﬂownodes.Thereforeitisoftennecessarytotakesubtreeswhenreusingcode.Furthermore,asimplereorderingwithaDSListherenotpossible.MaintainabilityChangesthatareintroducedaftertheinitialimplementa-tionshouldonlyrequiremodiﬁcationstothecorrespondingpart.TheDSDperformswellonthisaseachelementcanbemodiﬁedwithouttheneedtotouchothers.Furthermore,theintroductionofanewelementintotheDAGissimpleandonlyrequiresalocalchangeintheDSLdescriptionﬁle.Behaviortreesperformsimilarwellinthisregard.Incom-parison,inanFSMtheintroductionofanewstatemayrequireaddingtransitionstoallotherstates.TheDynamicStackDeciderallowstoexplicitlydeﬁnetherequiredbehaviorandenablesfastreplacementsofcodeparts.Sincetherootdecisioncanbedeﬁnedatthestart,itis123Content courtesy of Springer Nature, terms of use apply. Rights reserved.

InternationalJournalofSocialRobotics(2022)14:73–8381easytorunonlyapartofthebehaviororevenjustasingleaction.HumanreadableWhileprogramminganddebuggingitisnecessarytohaveaclearlyarrangedgraphicalrepresentationthatiseasytounderstandbythedeveloper.TheDSDperformswellinthisregardduetotheclearseparationbetweenactionsanddeci-sions,thesemanticlabelingofdecisionoutcomes,anditstree-likestructure.Whilebehaviortreesdoalsoprovideacleargraphicalrepresentation,theyaremoredifﬁculttoreadsincedifferentpartscanbeactiveatthesametimeandthetransitionshavenosemanticlabeling.AtypicalnegativeexampleistheFSMwherethehighnumberoftransitionsforcomplexsystemsresultsinclutteredgraphs.StatefulThestateofaDSDisdeﬁnedbyallelementsonitsstack.Thecurrentactiveactionelementisclearlyvisiblesinceitisthetop-mostelementinthestack.Theremainingelementsonthestackprovideinformationonthepreviouslytakendeci-sionsbutarealsopartofthestatesincetheyinﬂuencehowtheDSDwillactinthefuture,e.g.,byreevaluation.Inabehaviortree,thestateisdeﬁnedbyitscurrentlyactivenodes.Naturally,thereactiveapproachesSAandDThavenodeﬁnedstate.ScalabilityWhiletheDSDdoesgenerallyscalewelltocomplexprob-lems,ithasnoconceptofparallelexecutionandisthereforelimitedinthisregard.ItispossibletogetarounditbyrunningmultipleDSDsconcurrently,butthisonlyworkswelliftheyaremostlyindependentofeachother.Behaviortreesscalebettersincetheycanhandleparal-lelismeasilywiththeirtickconcept.1−−>Waiter2$CustomersWaiting3"None"−−>$ContinousRoomCheck4"Clean"−−>@CleanFloor5"Check"−−>@CheckRoom+room:1,@CheckRoom+(cid:2)→room:2,@CheckRoom+room:36"AtLeastOne"−−>$CustomerDistance7"Far"−−>@GoToCustomer8"Near"−−>$SpeakWithCustomer9"WantsToOrder"−−>@TakeOrder10"BringBill"−−>@BringBill11"Complains"−−>@FetchManagerListing3CorrespondingDSLfortheexampleDSDdisplayedinFigure6.ConceptcomprehensibilityTheamountoftimewhichisspenttounderstandhowaframeworkworksshouldbeaslowaspossibletokeepthedevelopmenttimetoaminimum.Someconcepts,i.e.BTandDSD,needmoretimetounderstand,astheyaremorecom-plexandlessintuitive.Othermoresimplisticframeworks,forexample,onesbasedonDecisionsTrees,arefastertounderstandbuttendtonothavethesameusabilityforlargerprojects.6ExampleTobetterdemonstratehowtheDSDworksanditsbeneﬁts,weconsiderarobotwaiterscenario.Therobotworksinathree-roomrestaurantwhereitshouldservecustomersbutalsocleanwhenpossible.Itmayﬁndwaitingcustomersran-domlywhilecleaning,buttokeepthewaitingtimelow,itshouldstopcleaningandsearchforcustomersinallthreeroomseverythreeminutes.Whenacustomerisfound,therobotneedstodrivetowardsit,andthenitshoulddealwithallwishesofthiscustomerbeforegoingtoanotherone.AnoverviewoftheresultingDSDisdisplayedinFig.6andthecorrespondingdescriptionintheDSLisshowninListing3.Inthebeginning,therobotiscleaning.Aftersometime,theContinousRoomCheckisreevaluatedandanactionsequenceispushedonthestack.Itconsistsofthreetimesthesameaction,butwithdifferentarguments.Therobotcheckstheﬁrstroomandthecorrespondingactionispopped.Dur-ingthecheckofthesecondroom,twocustomersarefound.Thereforetherootdecisionisreevaluatedandfurtherroomchecksareaborted.Therobotdrivestotheﬁrstcustomerandseeswhathewants.Afterbringingthebill,thecustomercomplains.Onlyaftercompletelyservingthiscustomertherobotdrivestothesecondandtakesitsorder.Afterward,itcontinuescleaning.TheDSDimplementationofthisscenariostayssmall(fourdecisionsandsixactions)andiseasilyreadableduetoitssemanticdecisions.Theadaptablereevaluationmecha-nismallowsconstantcheckingfornewcustomersoncurrentcameraimageswhilemovingintootherroomstosearchforcustomersisonlyperformedperiodically,asthisinterruptsthecleaningprocess.Whiletherobotservesacustomer,itusesDoNotReevaluatetomakesureitisnotinterrupted.Thereevaluationmechanismallowsgivingaclearhierarchicalorganizationofthedifferenttasksbyspecifyingwhichtaskscaninterruptothers.Thecheckingofthethreeroomsisutilizingtheabilitytoprovideargumentstoactionsandisformedbyusinganactionsequence.Iftherobotshouldbeexpanded,e.g.,byaBringOrderaction,thiscanbedoneeasilybyaddinganotheraction.ThecurrentstackoftheDSDprovidesaclearstateoftherobot’sbehavior,whichcould,forexample,beusedbyahumansupervisor.123Content courtesy of Springer Nature, terms of use apply. Rights reserved.

82InternationalJournalofSocialRobotics(2022)14:73–83CustomersWaiting[Reevaluate]ContinousRoomCheck[Reevaluate every 3min]CheckNoneSpeakWithCustomerCleanAtLeastOneWantsToOrderWantsBillComplainsCustomersWaitingContinousRoomCheckCleanFloorCleanFloorCheckRoom(1),CheckRoom(2),CheckRoom(3)TakeOrder[DoNotReev.]BringBill[DoNotReev.]FetchManager[DoNotReev.]CustomersWaitingContinousRoomCheckCheckRoom(3)CheckRoom(2)CheckRoom(1)CustomersWaitingContinousRoomCheckCheckRoom(3)CheckRoom(2)CustomersWaitingSpeakWithCustomerBringBillCustomersWaitingSpeakWithCustomerFetchManagerCustomersWaitingContinousRoomCheckCleanFloorCustomerDistanceNearGoToCustomerFarCustomersWaitingCustomerDistanceGoToCustomerCustomerDistanceCustomerDistanceCustomersWaitingCustomerDistanceGoToCustomerCustomersWaitingTakeOrderCustomerDistance123456789Fig.6ExampleofaDSDforarobotwaiter.TheDAG(left)showsthestructureoftheDSDwithannotationsdisplayingthereevaluationbehavior.Thestacks(right)showstepsinanexemplaryscenario7ConclusionWepresentedalightweight,open-sourcecontrolarchitec-tureforrobotsandsoftwareagents.Thepresentedapproach,calledDynamicStackDecider(DSD),givesseveralbeneﬁtsoverexistingtechniques.Mostimportantly,thecurrentstateofthebehavior,aswellasthedecisionsleadingtothisstate,areclearatalltimes.Furthermore,decisionsandactionsareclearlydifferentiated,reusable,andreplaceable.TheDSDcaneasilybecreatedusingitsowndomain-speciﬁclanguage,afeaturenootherframeworkprovides.InSection5weshowedthebeneﬁtsoverexistingapproaches,especiallyinreadabilityandmaintainability.Ourmodelfocusesonmorecomplexbehaviorswithhighread-abilityandgoodmaintainability.Further,itshowsitsbeneﬁtsinthedevelopmentprocess,asitallowseasycodereuseandoffersgoodhumanreadability.Forthis,wemadeatrade-offwhichlimitedthepossibilitiesofparallelismandthesimplic-ityoftheconcept.Findinganobjectivemeasurementforthebestframe-workishard,ifnotimpossible.Further,thescenariowherethesystemisuseddetermineshowwell-suitedanapproachis.However,weareconﬁdentthattheproposedframeworkworksverywellforalotofusecases.Itprovidesagreatapproachforwritingeasyunderstandableandmaintainablesoftware.TheRoboCupcontextwaschosenasanexample,asthisprovidesaconvenientscenario,showingacomplexenvi-ronmentwhilemaintainingunderstandableandshowinganalternativeapplicationasidefromtheoftenshownexamplesinresearch,asrobotnavigationandrelatedbehaviors.Weprovideareferenceimplementation6,whichhasbeenusedinRoboCupcompetitionsforseveralyearsandwasfurtherextendedandimprovedovertheyears.Theapproachwiththisimplementationwasalsousedinsocialdomainsonmobileandnon-mobileplatforms(seeSection1)andwillbeusedforfurtherresearch.ThewrittensoftwareisprovidedasaROSpackageandisthereforeeasytointegrateintoexistingsystems.ItcanutilizemanytoolsandlibrariesprovidedbyROS,asrqtortheloggingenvironment.WhileitisreadytoworkwithROS,itcanstillbeusedROSagnosticineveryenvironmentwhichsupportsPython.AcknowledgementsThankstoNilsRokitaforhelpingtoimplementtheDSD,thankstoFinn-ThorbenSellforimplementingthevisualiza-tiontool,thankstoTimonEngelkeforcleaninguptheimplementation,andthankstotheHamburgBit-Botsforthesupport.DeclarationsConﬂictofinterestTheauthorsdeclarethattheyhavenoconﬂictofinterest.OpenAccessThisarticleislicensedunderaCreativeCommonsAttribution4.0InternationalLicense,whichpermitsuse,sharing,adap-tation,distributionandreproductioninanymediumorformat,aslongasyougiveappropriatecredittotheoriginalauthor(s)andthesource,providealinktotheCreativeCommonslicence,andindi-cateifchangesweremade.Theimagesorotherthirdpartymaterialinthisarticleareincludedinthearticle’sCreativeCommonslicence,unlessindicatedotherwiseinacreditlinetothematerial.Ifmaterialisnotincludedinthearticle’sCreativeCommonslicenceandyourintendeduseisnotpermittedbystatutoryregulationorexceedsthepermitteduse,youwillneedtoobtainpermissiondirectlyfromthecopy-6https://github.com/bit-bots/dynamic_stack_decider123Content courtesy of Springer Nature, terms of use apply. Rights reserved.

InternationalJournalofSocialRobotics(2022)14:73–8383rightholder.Toviewacopyofthislicence,visithttp://creativecommons.org/licenses/by/4.0/.References1.AdouaneL(2016)Autonomousvehiclenavigation:frombehav-ioraltohybridmulti-controllerarchitectures.CRCPress.000182.ArkinRC(1998)Arkin.Behavior-BasedRobotics.p04358MITpress,R.C3.BestmannM,BrandtH,EngelkeT,FiedlerN,GabelA,GüldensteinJ,HaggeJ,HartﬁllJ,LorenzT,HeuerT,etal(2019)Hamburgbit-botsandwfwolvesteamdescriptionforrobocup2019humanoidkidsize.In:RoboCupSymposium4.BestmannM,ZhangJ(2020)Humanoidcontrolmodule:Anabstractionlayerforhumanoidrobots.In:2020IEEEInternationalConferenceonAutonomousRobotSystemsandCompetitions(ICARSC),pp263–268.IEEE5.BrooksR(1986)Arobustlayeredcontrolsystemforamobilerobot.IEEEJRobotAutom2(1):14–236.ColledanchiseM,ÖgrenP(2017)BehaviorTreesinRoboticsandAI:AnIntroduction.https://doi.org/10.1201/97804294891057.DromeyG(2003).Fromrequirementstodesign:formalizingthekeysteps.https://doi.org/10.1109/SEFM.2003.1236202.https://doi.org/10.1109/SEFM.2003.12362028.FikesRE,NilssonNJ(1971)Strips:anewapproachtotheapplicationoftheoremprovingtoproblemsolving.ArtifIntell2(3–4):189–2089.Gillaintroductiontothetheoryofﬁnite-statemachines(1962).https://doi.org/10.1109/PROC.1963.254810.HarelD(1987)Statecharts:avisualformalismforcomplexsys-tems.SciComputProgram8(3):231–274.https://doi.org/10.1016/0167-6423(87)90035-911.KitanoH,AsadaM,KuniyoshiY,NodaI,OsawaERoboCupTherobotworldcupinitiative.Tech.rep.https://doi.org/10.1145/267658.26773812.OrkinJ(2003)Applyinggoal-orientedactionplanningtogames.AIgameprogrammingwisdom2pp.217–227.http://alumni.media.mit.edu/~jorkin/GOAP_draft_AIWisdom2_2003.pdf13.QuinlanJR(1986)Inductionofdecisiontrees.MachLearn1(1):81–106.https://doi.org/10.1007/BF0011625114.SannerMF(1999)Python:aprogramminglanguageforsoft-wareintegrationanddevelopment.JMoleGrModell17(1):57–61.https://doi.org/10.1016/S1093-3263(99)99999-0Publisher’sNoteSpringerNatureremainsneutralwithregardtojuris-dictionalclaimsinpublishedmapsandinstitutionalafﬁliations.123Terms and Conditions

Springer Nature journal content, brought to you courtesy of Springer Nature Customer Service Center GmbH (“Springer Nature”).
Springer Nature supports a reasonable amount of sharing of  research papers by authors, subscribers and authorised users (“Users”), for small-
scale personal, non-commercial use provided that all copyright, trade and service marks and other proprietary notices are maintained. By
accessing, sharing, receiving or otherwise using the Springer Nature journal content you agree to these terms of use (“Terms”). For these
purposes, Springer Nature considers academic use (by researchers and students) to be non-commercial.
These Terms are supplementary and will apply in addition to any applicable website terms and conditions, a relevant site licence or a personal
subscription. These Terms will prevail over any conflict or ambiguity with regards to the relevant terms, a site licence or a personal subscription
(to the extent of the conflict or ambiguity only). For Creative Commons-licensed articles, the terms of the Creative Commons license used will
apply.
We collect and use personal data to provide access to the Springer Nature journal content. We may also use these personal data internally within
ResearchGate and Springer Nature and as agreed share it, in an anonymised way, for purposes of tracking, analysis and reporting. We will not
otherwise disclose your personal data outside the ResearchGate or the Springer Nature group of companies unless we have your permission as
detailed in the Privacy Policy.
While Users may use the Springer Nature journal content for small scale, personal non-commercial use, it is important to note that Users may
not:

1.

use such content for the purpose of providing other users with access on a regular or large scale basis or as a means to circumvent access

control;

2.

use such content where to do so would be considered a criminal or statutory offence in any jurisdiction, or gives rise to civil liability, or is

otherwise unlawful;

3.

falsely or misleadingly imply or suggest endorsement, approval , sponsorship, or association unless explicitly agreed to by Springer Nature in

writing;
use bots or other automated methods to access the content or redirect messages

4.

5.

override any security feature or exclusionary protocol; or

6.

share the content in order to create substitute for Springer Nature products or services or a systematic database of Springer Nature journal

content.

In line with the restriction against commercial use, Springer Nature does not permit the creation of a product or service that creates revenue,
royalties, rent or income from our content or its inclusion as part of a paid for service or for other commercial gain. Springer Nature journal
content cannot be used for inter-library loans and librarians may not upload Springer Nature journal content on a large scale into their, or any
other, institutional repository.
These terms of use are reviewed regularly and may be amended at any time. Springer Nature is not obligated to publish any information or
content on this website and may remove it or features or functionality at our sole discretion, at any time with or without notice. Springer Nature
may revoke this licence to you at any time and remove access to any copies of the Springer Nature journal content which have been saved.
To the fullest extent permitted by law, Springer Nature makes no warranties, representations or guarantees to Users, either express or implied
with respect to the Springer nature journal content and all parties disclaim and waive any implied warranties or warranties imposed by law,
including merchantability or fitness for any particular purpose.
Please note that these rights do not automatically extend to content, data or other material published by Springer Nature that may be licensed
from third parties.
If you would like to use or distribute our Springer Nature journal content to a wider audience or on a regular basis or in any other manner not
expressly permitted by these Terms, please contact Springer Nature at

onlineservice@springernature.com

